import"./modulepreload-polyfill-B5Qt9EMX.js";import{p as L,r as P}from"./topBar-Ccw8a5qR.js";const l="https://www.relda.com.br",S=JSON.parse(localStorage.getItem("userData"));document.addEventListener("DOMContentLoaded",()=>{L("cadastros"),P("cadastros",S.permissions_list)});document.addEventListener("DOMContentLoaded",function(){const a=new URLSearchParams(window.location.search).get("id"),m=document.getElementById("customerForm"),s=()=>{B(),a?y(a):r()},r=()=>{document.getElementById("page-title").textContent="Cadastro de Clientes",document.getElementById("page-subtitle").textContent="Preencha os dados do novo cliente"},y=async e=>{document.getElementById("page-title").textContent="Editar Cliente",document.getElementById("page-subtitle").textContent="Altere os dados do cliente abaixo",document.getElementById("saveButton").innerHTML='<i class="fas fa-save mr-2"></i>Salvar Alterações';try{const t=await fetch(`${l}/api/cadastros/customers/${e}/`,{credentials:"include"});if(!t.ok)throw new Error("Não foi possível carregar os dados do cliente.");const n=await t.json();v(n)}catch(t){o(t.message,"error"),setTimeout(()=>window.location.href="clientes.html",2e3)}},v=e=>{document.getElementById("customerId").value=e.id,document.getElementById("customerName").value=e.name,document.getElementById("customerType").value=e.customer_type,document.getElementById("customerDocument").value=e.document,document.getElementById("customerPhone").value=e.phone,document.getElementById("customerEmail").value=e.email,document.getElementById("customerStatus").value=e.status,document.getElementById("customerBirthDate").value=e.birth_date||"",document.getElementById("customerNotes").value=e.notes||"",e.address&&(document.getElementById("customerCEP").value=e.address.cep||"",document.getElementById("customerStreet").value=e.address.street||"",document.getElementById("customerNumber").value=e.address.number||"",document.getElementById("customerComplement").value=e.address.complement||"",document.getElementById("customerNeighborhood").value=e.address.neighborhood||"",document.getElementById("customerCity").value=e.address.city||"",document.getElementById("customerState").value=e.address.state||"",document.getElementById("customerCountry").value=e.address.country||"Brasil"),document.getElementById("customerType").dispatchEvent(new Event("change"))},B=()=>{const e=document.getElementById("infoTab"),t=document.getElementById("addressTab"),n=document.getElementById("nextTab"),u=document.getElementById("previousTab");e.addEventListener("click",()=>d("info")),t.addEventListener("click",()=>d("address")),n.addEventListener("click",()=>{i()&&d("address")}),u.addEventListener("click",()=>d("info")),document.getElementById("customerType").addEventListener("change",I),document.getElementById("searchCEP").addEventListener("click",p),m.addEventListener("submit",b)},d=e=>{const t=e==="info";document.getElementById("infoTab").classList.toggle("active",t),document.getElementById("addressTab").classList.toggle("active",!t),document.getElementById("infoContent").classList.toggle("hidden",!t),document.getElementById("addressContent").classList.toggle("hidden",t),document.getElementById("previousTab").classList.toggle("hidden",t),document.getElementById("nextTab").classList.toggle("hidden",!t)},I=e=>{const t=e.target.value==="PJ";document.getElementById("documentLabel").textContent=t?"CNPJ*":"CPF*",document.getElementById("birthDateField").classList.toggle("hidden",t)},p=async()=>{const e=document.getElementById("customerCEP").value.replace(/\D/g,"");if(e.length!==8)return o("CEP inválido.","error");try{const t=await fetch(`https://viacep.com.br/ws/${e}/json/`);if(!t.ok||t.erro)throw new Error;const n=await t.json();h(n)}catch{o("CEP não encontrado.","error")}},h=e=>{document.getElementById("customerStreet").value=e.logradouro,document.getElementById("customerNeighborhood").value=e.bairro,document.getElementById("customerCity").value=e.localidade,document.getElementById("customerState").value=e.uf},b=async e=>{if(e.preventDefault(),!i()){d("info");return}const t=document.getElementById("customerId").value,n=t?`${l}/api/cadastros/customers/${t}/`:`${l}/api/cadastros/customers/`,u=t?"PUT":"POST",g={name:document.getElementById("customerName").value,customer_type:document.getElementById("customerType").value,document:document.getElementById("customerDocument").value,phone:document.getElementById("customerPhone").value,email:document.getElementById("customerEmail").value,birth_date:document.getElementById("customerBirthDate").value||null,status:document.getElementById("customerStatus").value,notes:document.getElementById("customerNotes").value,address:null},E=document.getElementById("customerCEP").value;E&&(g.address={cep:E,street:document.getElementById("customerStreet").value,number:document.getElementById("customerNumber").value,complement:document.getElementById("customerComplement").value,neighborhood:document.getElementById("customerNeighborhood").value,city:document.getElementById("customerCity").value,state:document.getElementById("customerState").value,country:document.getElementById("customerCountry").value});try{const c=await fetch(n,{method:u,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(g)});if(!c.ok){const f=await c.json(),C=Object.entries(f).map(([w,T])=>`${w}: ${T.join(", ")}`).join("; ");throw new Error(C||"Erro ao salvar os dados.")}o("Cliente salvo com sucesso!","success"),setTimeout(()=>window.location.href="clientes.html",1500)}catch(c){o(c.message,"error")}},i=()=>{const e=["customerName","customerType","customerDocument","customerPhone","customerEmail","customerStatus"];for(const t of e)if(!document.getElementById(t).value)return o(`O campo "${document.getElementById(t).previousElementSibling.textContent}" é obrigatório.`,"error"),!1;return!0};s()});function o(a,m="success"){const s=document.getElementById("toast"),r=document.getElementById("toast-message");s.className=`fixed bottom-5 right-5 px-5 py-3 rounded-lg shadow-lg text-white ${m==="success"?"bg-green-500":"bg-red-500"}`,r.textContent=a,s.classList.remove("hidden"),setTimeout(()=>s.classList.add("hidden"),3e3)}
