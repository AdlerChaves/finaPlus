import"./modulepreload-polyfill-B5Qt9EMX.js";import{p as C,r as S}from"./topBar-Ccw8a5qR.js";const E="https://www.relda.com.br",N=JSON.parse(localStorage.getItem("userData"));document.addEventListener("DOMContentLoaded",()=>{C("cadastros"),S("cadastros",N.permissions_list)});document.addEventListener("DOMContentLoaded",function(){const m=new URLSearchParams(window.location.search).get("id"),p=document.getElementById("supplierForm"),l=()=>{o(),m&&r(m)},r=async e=>{document.querySelector("h1").textContent="Editar Fornecedor",document.getElementById("saveButton").innerHTML='<i class="fas fa-save mr-2"></i>Salvar Alterações';try{const t=await fetch(`${E}/api/cadastros/suppliers/${e}/`,{credentials:"include"});if(t.status===401){window.location.href="fornecedores.html";return}if(!t.ok)throw new Error("Não foi possível carregar os dados.");const n=await t.json();g(n)}catch(t){i("Erro",t.message,"error"),setTimeout(()=>window.location.href="fornecedores.html",2e3)}},g=e=>{if(document.getElementById("supplierId").value=e.id,document.getElementById("supplierName").value=e.name,document.getElementById("supplierTradeName").value=e.trade_name||"",document.querySelector(`input[name="supplierType"][value="${e.supplier_type}"]`).checked=!0,document.getElementById("supplierDocument").value=e.document,document.getElementById("supplierStateRegistration").value=e.state_registration||"",document.getElementById("supplierMunicipalRegistration").value=e.municipal_registration||"",document.getElementById("supplierContactName").value=e.contact_name||"",document.getElementById("supplierPhone").value=e.phone,document.getElementById("supplierCellphone").value=e.cellphone||"",document.getElementById("supplierEmail").value=e.email,document.getElementById("supplierCategory").value=e.category||"",document.getElementById("supplierStatus").checked=e.status==="active",document.getElementById("supplierNotes").value=e.notes||"",e.address){const{cep:t,street:n,number:c,complement:a,neighborhood:s,city:d,state:u}=e.address;document.getElementById("supplierCEP").value=t||"",document.getElementById("supplierStreet").value=n||"",document.getElementById("supplierNumber").value=c||"",document.getElementById("supplierComplement").value=a||"",document.getElementById("supplierNeighborhood").value=s||"",document.getElementById("supplierCity").value=d||"",document.getElementById("supplierState").value=u||""}if(e.bank_account){const{bank:t,agency:n,account:c,account_type:a,pix_key:s}=e.bank_account;document.getElementById("supplierBank").value=t||"",document.getElementById("supplierAgency").value=n||"",document.getElementById("supplierAccount").value=c||"",document.getElementById("supplierAccountType").value=a||"corrente",document.getElementById("supplierPix").value=s||""}document.querySelector('input[name="supplierType"]:checked').dispatchEvent(new Event("change"))},o=()=>{document.querySelectorAll('input[name="supplierType"]').forEach(e=>{e.addEventListener("change",v)}),document.getElementById("searchCEP").addEventListener("click",I),p.addEventListener("submit",h)},v=e=>{const t=e.target.value==="PJ";document.getElementById("documentLabel").textContent=t?"CNPJ*":"CPF*",document.getElementById("stateRegistrationField").style.display=t?"block":"none",document.getElementById("municipalRegistrationField").style.display=t?"block":"none"},I=async()=>{},B=()=>{const e={supplierName:"Nome/Razão Social",supplierDocument:"Documento (CPF/CNPJ)",supplierPhone:"Telefone",supplierEmail:"E-mail"};for(const t in e){const n=document.getElementById(t);if(!n.value.trim())return i("Erro de Validação",`O campo "${e[t]}" é obrigatório.`,"error"),n.focus(),!1}return!0},h=async e=>{if(e.preventDefault(),!B())return;const t=document.getElementById("supplierId").value,n=t?`${E}/api/cadastros/suppliers/${t}/`:`${E}/api/cadastros/suppliers/`,c=t?"PUT":"POST",a={name:document.getElementById("supplierName").value,trade_name:document.getElementById("supplierTradeName").value,supplier_type:document.querySelector('input[name="supplierType"]:checked').value,document:document.getElementById("supplierDocument").value,state_registration:document.getElementById("supplierStateRegistration").value,municipal_registration:document.getElementById("supplierMunicipalRegistration").value,contact_name:document.getElementById("supplierContactName").value,phone:document.getElementById("supplierPhone").value,cellphone:document.getElementById("supplierCellphone").value,email:document.getElementById("supplierEmail").value,category:document.getElementById("supplierCategory").value,status:document.getElementById("supplierStatus").checked?"active":"inactive",notes:document.getElementById("supplierNotes").value},s=document.getElementById("supplierCEP").value;s&&(a.address={cep:s,street:document.getElementById("supplierStreet").value,number:document.getElementById("supplierNumber").value,complement:document.getElementById("supplierComplement").value,neighborhood:document.getElementById("supplierNeighborhood").value,city:document.getElementById("supplierCity").value,state:document.getElementById("supplierState").value});const d=document.getElementById("supplierBank").value;d&&(a.bank_account={bank:d,agency:document.getElementById("supplierAgency").value,account:document.getElementById("supplierAccount").value,account_type:document.getElementById("supplierAccountType").value,pix_key:document.getElementById("supplierPix").value});try{const u=await fetch(n,{method:c,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)});if(!u.ok){const f=await u.json(),b=Object.entries(f).map(([w,y])=>`${w}: ${Array.isArray(y)?y.join(", "):y}`).join("; ");throw new Error(b||"Erro ao salvar os dados.")}i("Sucesso!","Fornecedor salvo com sucesso.","success"),setTimeout(()=>window.location.href="/src/pages/fornecedores/fornecedores.html",1500)}catch(u){i("Erro!",u.message,"error")}};l()});function i(m,p,l){const r=document.getElementById("toast"),g=document.getElementById("toast-message");let o="bg-gray-800";l==="success"&&(o="bg-green-600"),l==="error"&&(o="bg-red-600"),l==="warning"&&(o="bg-yellow-600"),l==="info"&&(o="bg-blue-600"),r.className=`fixed bottom-5 right-5 px-5 py-3 rounded-lg shadow-lg text-white ${o}`,g.textContent=p,r.classList.remove("hidden"),r.classList.add("animate-fade-in"),setTimeout(()=>{r.classList.add("hidden")},4e3)}
