import"./modulepreload-polyfill-B5Qt9EMX.js";import{p as c,r as l}from"./topBar-DJwU6RwO.js";const a="https://www.relda.com.br",d=JSON.parse(localStorage.getItem("userData"));document.addEventListener("DOMContentLoaded",()=>{c("configuracoes"),l("configuracoes",d.permissions_list),r()});document.addEventListener("DOMContentLoaded",()=>{});function r(){fetch(`${a}/api/accounts/me/`,{headers:{"Content-Type":"application/json"},credentials:"include"}).then(e=>e.json()).then(e=>{document.getElementById("first-name").value=e.first_name||"",document.getElementById("last-name").value=e.last_name||"",document.getElementById("user-email").value=e.email||"";let t=e.phone||"";t.startsWith("+55")&&(t=t.substring(3));const n=document.getElementById("user-phone");n.value=t,IMask(n,{mask:"(00) 00000-0000"}),document.getElementById("theme-toggle").checked=e.theme==="dark",document.getElementById("currency").value=e.currency,document.getElementById("language").value=e.language,document.getElementById("weekly-goals-toggle").checked=e.notify_weekly_goals,document.getElementById("large-transactions-toggle").checked=e.notify_large_transactions,document.getElementById("bills-reminder-toggle").checked=e.notify_bills_reminder}).catch(e=>console.error("Erro ao carregar configurações:",e))}document.getElementById("save-settings").addEventListener("click",function(){const e=document.getElementById("user-phone").value.replace(/\D/g,""),t={first_name:document.getElementById("first-name").value,last_name:document.getElementById("last-name").value,phone:e?`+55${e}`:"",theme:document.getElementById("theme-toggle").checked?"dark":"light",currency:document.getElementById("currency").value,language:document.getElementById("language").value,notify_weekly_goals:document.getElementById("weekly-goals-toggle").checked,notify_large_transactions:document.getElementById("large-transactions-toggle").checked,notify_bills_reminder:document.getElementById("bills-reminder-toggle").checked};fetch(`${a}/api/accounts/me/`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)}).then(n=>{if(n.ok){const o=document.getElementById("toast-notification");o.classList.remove("hidden"),setTimeout(()=>o.classList.add("hidden"),3e3)}else n.json().then(o=>{console.error("Erro do servidor:",o),alert("Falha ao salvar. Verifique os dados e tente novamente.")})}).catch(n=>{console.error("Erro de rede ou de script:",n),alert("Não foi possível salvar as configurações. Verifique a sua conexão.")})});document.getElementById("update-password").addEventListener("click",function(){const e={current_password:document.getElementById("current-password").value,new_password:document.getElementById("new-password").value};if(e.new_password!==document.getElementById("confirm-password").value){alert("A nova senha e a confirmação não coincidem!");return}fetch(`${a}/api/accounts/change-password/`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${getAccessToken()}`},body:JSON.stringify(e)}).then(async t=>{if(t.ok)alert("Senha alterada com sucesso!"),document.getElementById("password-modal").classList.add("hidden");else{const n=await t.json(),o=Object.values(n).join(`
`);throw new Error(o)}}).catch(t=>{console.error("Erro ao alterar senha:",t),alert(`Erro: ${t.message}`)})});document.getElementById("confirm-delete").addEventListener("click",function(){fetch(`${a}/api/accounts/delete-account/`,{method:"DELETE",headers:{Authorization:`Bearer ${getAccessToken()}`}}).then(e=>{if(e.ok)alert("Conta excluída com sucesso!"),localStorage.clear(),window.location.href="./login.html";else throw new Error("Falha ao excluir a conta.")}).catch(e=>{console.error("Erro ao excluir conta:",e),alert("Não foi possível excluir a conta. Tente novamente.")})});document.getElementById("enable-2fa").addEventListener("click",function(){document.getElementById("twofa-modal").classList.remove("hidden")});document.getElementById("close-twofa-modal").addEventListener("click",function(){document.getElementById("twofa-modal").classList.add("hidden")});document.getElementById("enable-twofa").addEventListener("click",function(){const e=document.getElementById("twofa-code").value;if(!e||e.length!==6){alert("Por favor, insira um código de 6 dígitos válido");return}alert("Verificação em duas etapas ativada com sucesso (simulação)"),document.getElementById("twofa-modal").classList.add("hidden"),document.getElementById("enable-2fa").innerHTML='<i class="fas fa-shield-alt mr-2"></i> Configurado',document.getElementById("enable-2fa").classList.remove("bg-gray-100","text-gray-700"),document.getElementById("enable-2fa").classList.add("bg-green-100","text-green-700")});document.getElementById("export-data").addEventListener("click",function(){alert("Dados exportados com sucesso (simulação)")});document.getElementById("logout").addEventListener("click",function(){confirm("Tem certeza que deseja sair da sua conta?")&&fetch(`${a}/api/accounts/logout/`,{method:"POST"}).then(e=>{if(e.ok)localStorage.clear(),window.location.href="./login.html";else throw new Error("Falha ao fazer logout.")}).catch(e=>{console.error("Erro no logout:",e),alert("Não foi possível fazer logout. Tente novamente.")})});document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("financaplus-theme"),t=localStorage.getItem("financaplus-currency"),n=localStorage.getItem("financaplus-language");e==="dark"&&(document.getElementById("theme-toggle").checked=!0,document.body.classList.add("bg-gray-900","text-white")),t&&(document.getElementById("currency").value=t),n&&(document.getElementById("language").value=n)});
