import"./modulepreload-polyfill-B5Qt9EMX.js";import{p as i,r as u}from"./topBar-Ccw8a5qR.js";const s="https://www.relda.com.br";function m(){fetch(`${s}/api/accounts/me/`,{headers:{"Content-Type":"application/json"},credentials:"include"}).then(t=>{if(!t.ok)throw new Error("Falha ao carregar dados do usuário.");return t.json()}).then(t=>{document.getElementById("first-name").value=t.first_name||"",document.getElementById("last-name").value=t.last_name||"",document.getElementById("user-email").value=t.email||"";let n=t.phone||"";n.startsWith("+55")&&(n=n.substring(3));const r=document.getElementById("user-phone");r.value=n,typeof IMask<"u"&&IMask(r,{mask:"(00) 00000-0000"})}).catch(t=>console.error("Erro ao carregar configurações:",t))}document.addEventListener("DOMContentLoaded",()=>{const t=JSON.parse(localStorage.getItem("userData"));i("configuracoes"),u("configuracoes",t.permissions_list),m(),document.getElementById("save-settings").addEventListener("click",function(){const e=document.getElementById("user-phone").value.replace(/\D/g,""),o={first_name:document.getElementById("first-name").value,last_name:document.getElementById("last-name").value,phone:e?`+55${e}`:"",theme:document.getElementById("theme-toggle").checked?"dark":"light",currency:document.getElementById("currency").value,language:document.getElementById("language").value};fetch(`${s}/api/accounts/me/`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(o)}).then(a=>{if(a.ok){const c=document.getElementById("toast-notification");c.classList.remove("hidden"),setTimeout(()=>c.classList.add("hidden"),3e3)}else a.json().then(c=>{console.error("Erro do servidor:",c),alert("Falha ao salvar. Verifique os dados e tente novamente.")})}).catch(a=>{console.error("Erro de rede ou de script:",a),alert("Não foi possível salvar as configurações. Verifique a sua conexão.")})}),document.getElementById("logout").addEventListener("click",function(){confirm("Tem certeza que deseja sair da sua conta?")&&fetch(`${s}/api/accounts/logout/`,{method:"POST",credentials:"include"}).then(e=>{console.log("Logout solicitado."),localStorage.clear(),window.location.href="/src/pages/login/login.html"}).catch(e=>{console.error("Erro no logout:",e),alert("Não foi possível fazer logout. Verifique sua conexão."),localStorage.clear(),window.location.href="/src/pages/login/login.html"})}),document.getElementById("delete-account").addEventListener("click",function(){document.getElementById("delete-modal").classList.remove("hidden")}),document.getElementById("cancel-delete").addEventListener("click",function(){document.getElementById("delete-modal").classList.add("hidden")}),document.getElementById("confirm-delete").addEventListener("click",function(){fetch(`${s}/api/accounts/delete-account/`,{method:"DELETE",credentials:"include"}).then(e=>{if(e.ok||e.status===204)alert("Conta excluída com sucesso!"),localStorage.clear(),window.location.href="/src/pages/login/login.html";else throw new Error("Falha ao excluir a conta.")}).catch(e=>{console.error("Erro ao excluir conta:",e),alert("Não foi possível excluir a conta. Tente novamente.")})});const n=document.getElementById("change-password");n&&n.addEventListener("click",function(){document.getElementById("password-modal").classList.remove("hidden")}),document.getElementById("close-password-modal").addEventListener("click",function(){document.getElementById("password-modal").classList.add("hidden")}),document.getElementById("update-password").addEventListener("click",function(){const e={current_password:document.getElementById("current-password").value,new_password:document.getElementById("new-password").value};if(e.new_password!==document.getElementById("confirm-password").value){alert("A nova senha e a confirmação não coincidem!");return}fetch(`${s}/api/accounts/change-password/`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}).then(async o=>{if(o.ok)alert("Senha alterada com sucesso!"),document.getElementById("password-modal").classList.add("hidden");else{const a=await o.json(),c=Object.values(a).flat().join(`
`);throw new Error(c)}}).catch(o=>{console.error("Erro ao alterar senha:",o),alert(`Erro: ${o.message}`)})});const r=localStorage.getItem("financaplus-theme"),d=localStorage.getItem("financaplus-currency"),l=localStorage.getItem("financaplus-language");r==="dark"&&(document.getElementById("theme-toggle").checked=!0,document.body.classList.add("bg-gray-900","text-white")),d&&(document.getElementById("currency").value=d),l&&(document.getElementById("language").value=l)});
