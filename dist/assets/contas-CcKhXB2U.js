import"./modulepreload-polyfill-B5Qt9EMX.js";import{p as B,r as w}from"./topBar-DJwU6RwO.js";const s="https://www.relda.com.br",I=JSON.parse(localStorage.getItem("userData"));document.addEventListener("DOMContentLoaded",()=>{B("contas"),w("pagamentos",I.permissions_list),f()});const v=document.getElementById("account-modal"),h=document.getElementById("delete-modal"),L=document.getElementById("add-account-btn"),k=document.getElementById("save-account-btn"),$=document.getElementById("cancel-modal-btn"),M=document.getElementById("confirm-delete-btn"),C=document.getElementById("cancel-delete-btn"),y=document.getElementById("accounts-table-body"),E=document.getElementById("mobile-accounts-list"),D=document.getElementById("account-form"),x=document.getElementById("toast"),T=document.getElementById("toast-message");let p=null;function u(t){const n=parseFloat(t);return isNaN(n)?"R$ 0,00":n.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}async function f(){const t=document.getElementById("cards-button");let n=null;try{const a=await fetch(`${s}/api/finance/bank-accounts/`,{credentials:"include"});if(a.status===401){window.location.href="./login.html";return}if(!a.ok)throw new Error("Falha ao buscar contas. Faça login novamente.");const i=await a.json();if(y.innerHTML="",E.innerHTML="",i.length===0){y.innerHTML='<tr><td colspan="5" class="text-center py-4 text-gray-500">Nenhuma conta cadastrada.</td></tr>',t.classList.add("opacity-50","cursor-not-allowed"),t.href="#",n=e=>{e.preventDefault(),alert("Você precisa cadastrar ao menos uma conta bancária para cadastrar cartões.")},t.addEventListener("click",n),document.getElementById("total-balance-summary").textContent=u(0),document.getElementById("active-accounts-summary").textContent=0,document.getElementById("inactive-accounts-summary").textContent=0;return}else t.classList.remove("opacity-50","cursor-not-allowed"),t.href="/src/pages/cadastros/cartoes/cadastroCartoes.html",n&&t.removeEventListener("click",n);let r=0,l=0,m=0;i.forEach(e=>{e.is_active?(r+=parseFloat(e.initial_balance),l++):m++;const o=document.createElement("tr");o.innerHTML=`
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${e.name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${e.type}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${u(e.initial_balance)}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}">
                        ${e.is_active?"Ativa":"Inativa"}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button onclick="openEditModal(${e.id})" class="text-primary hover:text-primary-dark mr-3"><i class="fas fa-edit"></i></button>
                    <button onclick="openDeleteModal(${e.id})" class="text-danger hover:text-red-700"><i class="fas fa-trash-alt"></i></button>
                </td>
            `,y.appendChild(o);const c=document.createElement("div");c.className="p-4 border-b",c.innerHTML=`
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm font-medium text-gray-900">${e.name}</p>
                        <p class="text-xs text-gray-500 mt-1">${e.type} • ${u(e.initial_balance)}</p>
                    </div>
                    <div class="text-right">
                         <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}">
                            ${e.is_active?"Ativa":"Inativa"}
                        </span>
                    </div>
                </div>
                 <div class="mt-2 text-right">
                    <button onclick="openEditModal(${e.id})" class="text-primary hover:text-primary-dark mr-3"><i class="fas fa-edit"></i> Editar</button>
                    <button onclick="openDeleteModal(${e.id})" class="text-danger hover:text-red-700"><i class="fas fa-trash-alt"></i> Excluir</button>
                </div>
            `,E.appendChild(c)}),document.getElementById("total-balance-summary").textContent=u(r),document.getElementById("active-accounts-summary").textContent=l,document.getElementById("inactive-accounts-summary").textContent=m}catch(a){console.error("Erro:",a),d(a.message,"error")}}function _(){D.reset(),document.getElementById("modal-title").textContent="Adicionar Nova Conta",document.getElementById("account-id").value="",document.getElementById("status-active").checked=!0,v.classList.remove("hidden")}async function A(t){const n=await fetch(`${s}/api/finance/bank-accounts/${t}/`,{credentials:"include"});if(n.status===401){window.location.href="./login.html";return}if(!n.ok)throw new Error("Falha ao buscar dados da conta.");const a=await n.json();document.getElementById("modal-title").textContent="Editar Conta",document.getElementById("account-id").value=a.id,document.getElementById("account-name").value=a.name,document.getElementById("account-type").value=a.type,document.getElementById("account-balance").value=a.initial_balance,document.getElementById(a.is_active?"status-active":"status-inactive").checked=!0,document.getElementById("account-notes").value=a.notes,v.classList.remove("hidden")}function b(){v.classList.add("hidden")}async function N(){const t=document.getElementById("account-id").value,n=document.getElementById("account-name").value,a=document.getElementById("account-type").value,i=document.getElementById("account-balance").value,r=document.getElementById("status-active").checked,l=document.getElementById("account-notes").value,m=t?`${s}/api/finance/bank-accounts/${t}/`:`${s}/api/finance/bank-accounts/`,o=await fetch(m,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:n,type:a,initial_balance:i,is_active:r,notes:l})});if(o.ok)d(t?"Conta atualizada com sucesso!":"Conta criada com sucesso!","success"),b(),f();else{const c=await o.json();console.error("Erro ao salvar:",c),d("Ocorreu um erro ao salvar a conta.","error")}}function j(t){p=t,h.classList.remove("hidden")}function g(){p=null,h.classList.add("hidden")}async function F(){if(p)try{const t=await fetch(`${s}/api/finance/bank-accounts/${p}/`,{method:"DELETE",credentials:"include"});if(t.status!==204){const n=await t.json();throw new Error(n.detail||"Ocorreu um erro desconhecido.")}d("Conta excluída com sucesso!","success"),g(),f()}catch(t){d(t.message,"error"),g()}}function d(t,n="success"){T.textContent=t,x.className=`fixed bottom-4 right-4 text-white px-4 py-2 rounded-md shadow-lg toast ${n==="success"?"bg-green-500":"bg-red-500"}`,setTimeout(()=>{x.className="hidden"},3e3)}window.openEditModal=A;window.openDeleteModal=j;L.addEventListener("click",_);k.addEventListener("click",N);$.addEventListener("click",b);M.addEventListener("click",F);C.addEventListener("click",g);
