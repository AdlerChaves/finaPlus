import"./modulepreload-polyfill-B5Qt9EMX.js";function v(e,t){const o=window.location.pathname.endsWith("/")||window.location.pathname.endsWith("index.html"),a=o?"telas/":"",i=[{name:"Movimentações",permission:"movimentacoes",icon:'<svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>',submenus:[{name:"Entradas",href:`${a}entradas.html`},{name:"Saídas",href:`${a}saidas.html`}]},{name:"Relatórios",permission:"relatorios",icon:'<svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>',submenus:[{name:"DRE",href:`${a}DRE.html`},{name:"DFC",href:`${a}DFC.html`}]},{name:"Pagamentos/Recebimentos",permission:"pagamentos",icon:'<svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',submenus:[{name:"Contas a Pagar",href:`${a}contasPagar.html`},{name:"Contas a Receber",href:`${a}contasReceber.html`}]},{name:"Contas bancárias",permission:"contas",isSingleLink:!0,href:`${a}contas.html`,icon:'<svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4M4 7s0 4 8 4 8-4 8-4"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11v10"></path></svg>'},{name:"Cadastros",permission:"cadastros",icon:'<svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>',submenus:[{name:"Clientes",href:`${a}clientes.html`},{name:"Fornecedores",href:`${a}fornecedores.html`},{name:"Usuários",href:`${a}cadastroUsuario.html`},{name:"Categorias",href:`${a}cadastroCategorias.html`}]},{name:"Configurações",permission:"configuracoes",isSingleLink:!0,href:`${a}configuracoes.html`,icon:'<svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>'}];let s="",c="";const f="active font-semibold text-blue-600";s+=`<a href="${o?"index.html":"../index.html"}" class="menu-item ${f} hover:text-blue-500 transition-colors flex items-center">Dashboard</a>`,c+=`<a href="${o?"index.html":"../index.html"}" class="block py-2 ${f} hover:text-blue-500">Dashboard</a>`,i.forEach(n=>{if(t[n.permission]){const m=e===n.permission?"active font-semibold text-blue-600":"text-gray-700";n.isSingleLink?(s+=`<a href="${n.href}" class="menu-item ${m} hover:text-blue-500 transition-colors flex items-center self-center">${n.icon} ${n.name}</a>`,c+=`<a href="${n.href}" class="block py-2 ${m} hover:text-blue-500">${n.name}</a>`):(s+=`
                    <div class="relative group py-2">
                        <button class="px-3 py-2 ${m} hover:text-blue-500 transition-colors flex items-center">
                            ${n.icon} ${n.name}
                        </button>
                        <div class="absolute left-0 mt-2 w-56 bg-white rounded-md shadow-lg py-1 z-30 hidden group-hover:block">
                            ${n.submenus.map(l=>`<a href="${l.href}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600">${l.name}</a>`).join("")}
                        </div>
                    </div>`,c+=`
                    <div class="py-2">
                        <p class="font-semibold text-gray-500 text-sm px-4">${n.name}</p>
                        ${n.submenus.map(l=>`<a href="${l.href}" class="block pl-8 pr-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600">${l.name}</a>`).join("")}
                    </div>`)}});const x=`
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center">
                    <span class="text-white font-bold">RD</span>
                </div>
                <h1 class="text-xl font-semibold text-gray-800">Relda</h1>
            </div>
            <nav class="hidden md:flex space-x-1 items-center">${s}</nav>
            <button id="mobile-menu-button" class="md:hidden text-gray-600 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200 px-4 py-2">${c}</div>
    `,d=document.createElement("header");d.className="fixed top-0 left-0 right-0 bg-white shadow-sm z-20",d.innerHTML=x,document.body.prepend(d),document.getElementById("mobile-menu-button").addEventListener("click",()=>{document.getElementById("mobile-menu").classList.toggle("hidden")})}const y="http://api.relda.com.br";async function w(){try{const e=await fetch(`${y}/api/accounts/me/`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(e.ok)return await e.json();throw new Error("Usuário não autenticado.")}catch(e){return console.error("Falha na verificação de autenticação:",e.message),localStorage.clear(),window.location.href="/src/pages/login/login.html",null}}function k(e,t=[]){const o={};t.forEach(s=>{typeof s=="string"&&(o[s.toLowerCase()]=!0)});const a={dashboard:["dashboard"],pagamentos:["contas a pagar","contas a receber","pagamentos","contas-a-receber"],movimentacoes:["entradas","saidas"],relatorios:["dre","dfc"],cadastros:["clientes","fornecedores","usuarios","categorias"],contas:["contas bancarias","contas"],configuracoes:["configuracoes"]};for(const s in a)a[s].some(c=>o[c])&&(o[s]=!0);if(localStorage.getItem("userRole")!=="admin"&&e&&!o[e.toLowerCase()]){console.warn(`Acesso negado para conteúdo. Permissão necessária: '${e}'`),alert("Você não tem permissão para acessar esta página."),window.location.href="/index.html";return}v(e,o)}async function C(e){const t=await w();if(t){const o=t.permissions_list||[];k(e,o);const a=`${t.first_name} ${t.last_name}`.trim();a&&localStorage.setItem("userName",a)}}const p="http://api.relda.com.br";let u=null,h=null;document.addEventListener("DOMContentLoaded",async function(){try{await C("dashboard"),console.log("Autenticação confirmada. Carregando a página..."),B(),g(),I(),$(),M()}catch(e){console.error("Ocorreu um erro durante a inicialização da página:",e)}});function g(){const e=localStorage.getItem("userName");if(e){const t=document.getElementById("user-name-display");t&&(t.textContent=e)}}async function $(){try{const e=await fetch(`${p}/finance/charts/income-expense/`,{credentials:"include"});if(!e.ok)throw new Error("Falha ao buscar dados do gráfico.");const t=await e.json();E(t)}catch(e){console.error("Erro ao carregar dados do gráfico:",e)}}function E(e){var o;const t=(o=document.getElementById("barChart"))==null?void 0:o.getContext("2d");t&&(u&&u.destroy(),u=new Chart(t,{type:"bar",data:{labels:e.labels,datasets:[{label:"Receitas",data:e.income_data,backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1},{label:"Despesas",data:e.expense_data,backgroundColor:"rgba(255, 99, 132, 0.6)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}}))}async function M(){try{const e=await fetch(`${p}/api/finance/charts/cash-flow/`,{credentials:"include"});if(!e.ok)throw new Error("Falha ao buscar dados do fluxo de caixa.");const t=await e.json();L(t)}catch(e){console.error("Erro ao carregar dados do fluxo de caixa:",e)}}function L(e){var o;const t=(o=document.getElementById("lineChart"))==null?void 0:o.getContext("2d");t&&(h&&h.destroy(),h=new Chart(t,{type:"line",data:{labels:e.labels,datasets:[{label:"Saldo Acumulado",data:e.cumulative_balance,fill:!1,borderColor:"rgba(54, 162, 235, 1)",backgroundColor:"rgba(54, 162, 235, 0.6)",tension:.1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!1}}}}))}function B(){const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-sidebar"),o=document.getElementById("close-sidebar"),a=document.getElementById("sidebar-overlay");if(e&&t&&o&&a){e.addEventListener("click",()=>{t.classList.remove("-translate-x-full"),a.classList.remove("hidden")});const i=()=>{t.classList.add("-translate-x-full"),a.classList.add("hidden")};o.addEventListener("click",i),a.addEventListener("click",i)}}async function I(){console.log("Iniciando a função loadDashboardData...");try{const e=await fetch(`${p}/api/finance/dashboard/`,{credentials:"include"});if(console.log("Resposta da API recebida com status:",e.status),e.status===401){console.error("Não autorizado (401). Redirecionando para login."),window.location.href="./src/pages/login/login.html";return}if(!e.ok)throw new Error(`Falha na rede: ${e.statusText}`);const t=await e.json();console.log("Dados recebidos do backend:",t),D(t.summary_cards),R(t.alerts.upcoming_payables),_(t.recent_transactions),t.user_info&&t.user_info.name&&(localStorage.setItem("userName",t.user_info.name),g())}catch(e){console.error("Erro fatal ao buscar dados do dashboard:",e);const t=document.getElementById("upcoming-payables-container");t&&(t.innerHTML=`<div class="p-4 bg-red-50 text-red-700 rounded-lg">
                    <p class="font-bold">Erro de Conexão</p>
                    <p class="text-sm">Não foi possível carregar os dados do dashboard. Verifique sua conexão e tente recarregar a página.</p>
                </div>`)}}const r=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e||0),b=e=>e?new Date(e).toLocaleDateString("pt-BR",{timeZone:"UTC"}):"Data inválida";function D(e){if(!e)return;document.getElementById("current-balance").textContent=r(e.current_balance),document.getElementById("monthly-income").textContent=r(e.monthly_income),document.getElementById("monthly-expenses").textContent=r(e.monthly_expenses);const t=document.getElementById("monthly-result");t.textContent=r(e.monthly_result),t.className=e.monthly_result>=0?"text-2xl font-bold mt-1 text-green-600":"text-2xl font-bold mt-1 text-red-600",document.getElementById("total-payables").textContent=r(e.total_payables),document.getElementById("total-receivables").textContent=r(e.total_receivables)}function R(e){const t=document.getElementById("upcoming-payables-container");if(t){if(t.innerHTML="",!e||e.length===0){t.innerHTML='<p class="text-sm text-gray-500 p-3 bg-gray-50 rounded-lg">Nenhum vencimento nos próximos 7 dias.</p>';return}e.forEach(o=>{t.innerHTML+=`
                <div class="flex justify-between items-center p-3 bg-yellow-50 rounded-lg">
                    <div>
                        <p class="text-sm font-medium">${o.description}</p>
                        <p class="text-xs text-gray-500">Vence em: ${b(o.due_date)}</p>
                    </div>
                    <p class="text-sm font-bold text-yellow-600">${r(o.amount)}</p>
                </div>`})}}function _(e){const t=document.getElementById("recent-transactions-container");if(t){if(t.innerHTML="",!e||e.length===0){t.innerHTML='<p class="text-sm text-gray-500 p-3">Nenhum lançamento recente.</p>';return}e.forEach(o=>{const a=o.type==="entrada",i=a?"text-green-600":"text-red-600",s=a?"+":"-";t.innerHTML+=`
                <div class="flex justify-between items-center pb-3 mb-3 border-b last:border-b-0">
                    <div>
                        <p class="text-sm font-medium">${o.description}</p>
                        <p class="text-xs text-gray-500">${b(o.transaction_date)}</p>
                    </div>
                    <p class="text-sm font-bold ${i}">${s} ${r(o.amount)}</p>
                </div>`})}}
