<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinançaPlus | Cartões de Crédito</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .modal-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.95);
        }
        .toast {
            animation: slideIn 0.5s, fadeOut 0.5s 2.5s;
        }
        @keyframes slideIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .card-brand {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 25px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Main Content -->
    <main class="mt-16 pt-6 pb-20">
        <div class="container mx-auto px-4">
            <!-- Page Header -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Gestão de Cartões</h2>
                <div class="mt-4 md:mt-0">
                    <button id="openModalBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center">
                        <i class="fas fa-credit-card mr-2"></i>
                        Cadastrar Cartão de Crédito
                    </button>
                </div>
    
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow-sm p-4 border border-gray-100">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-500 mr-4"><i class="fas fa-credit-card"></i></div>
                        <div>
                            <p class="text-sm text-gray-500">Cartões Ativos</p>
                            <p id="active-cards-count" class="text-xl font-bold text-gray-800">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-4 border border-gray-100">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100 text-green-500 mr-4"><i class="fas fa-wallet"></i></div>
                        <div>
                            <p class="text-sm text-gray-500">Limite Consolidado</p>
                            <p id="total-limit" class="text-xl font-bold text-gray-800">R$ 0,00</p>
                        </div>
                    </div>
                </div>
                 <div class="bg-white rounded-lg shadow-sm p-4 border border-gray-100">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-yellow-100 text-yellow-500 mr-4"><i class="fas fa-calendar-alt"></i></div>
                        <div>
                            <p class="text-sm text-gray-500">Próximo Vencimento</p>
                            <p id="next-due-date" class="text-xl font-bold text-gray-800">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm overflow-hidden border border-gray-100">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome do Cartão</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bandeira</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Últimos 4 Dígitos</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Limite</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="cards-table-body" class="bg-white divide-y divide-gray-200">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
        </div>
    </main>

    <!-- Modal -->
    <div id="creditCardModal" class="modal fixed inset-0 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>

            <!-- Modal content -->
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-credit-card text-blue-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modalTitle">
                                Cadastrar Cartão de Crédito
                            </h3>
                            
                            <div class="mt-4">
                                <form id="creditCardForm" class="space-y-4">
                                    <!-- Card Name -->
                                    <div class="relative">
                                        <label for="cardName" class="block text-sm font-medium text-gray-700">Nome do Cartão *</label>
                                        <input type="text" id="cardName" name="cardName" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Ex: Cartão Santander PJ">
                                        <div id="cardNameError" class="hidden mt-1 text-sm text-red-600">Por favor, insira um nome para o cartão</div>
                                    </div>
                                    
                                    <!-- Card Brand -->
                                    <div class="relative">
                                        <label for="cardBrand" class="block text-sm font-medium text-gray-700">Bandeira *</label>
                                        <select id="cardBrand" name="cardBrand" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                            <option value="">Selecione uma bandeira</option>
                                            <option value="Visa">Visa</option>
                                            <option value="MasterCard">MasterCard</option>
                                            <option value="Elo">Elo</option>
                                            <option value="American Express">American Express</option>
                                            <option value="Hipercard">Hipercard</option>
                                            <option value="Diners Club">Diners Club</option>
                                            <option value="Outra">Outra</option>
                                        </select>
                                        <div id="cardBrandError" class="hidden mt-1 text-sm text-red-600">Por favor, selecione uma bandeira</div>
                                    </div>
                                    
                                    <!-- Last 4 Digits -->
                                    <div class="relative">
                                        <label for="lastDigits" class="block text-sm font-medium text-gray-700">Últimos 4 dígitos *</label>
                                        <input type="text" id="lastDigits" name="lastDigits" maxlength="4" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="1234">
                                        <div id="lastDigitsError" class="hidden mt-1 text-sm text-red-600">Por favor, insira os 4 últimos dígitos</div>
                                        <div id="invalidDigitsError" class="hidden mt-1 text-sm text-red-600">Os dígitos devem conter apenas números</div>
                                    </div>
                                    
                                    <!-- Credit Limit -->
                                    <div>
                                        <label for="creditLimit" class="block text-sm font-medium text-gray-700">Limite Total *</label>
                                        <div class="mt-1 relative rounded-md shadow-sm">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <span class="text-gray-500 sm:text-sm">R$</span>
                                            </div>
                                            <input type="text" id="creditLimit" name="creditLimit" class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 pr-12 py-2 border-gray-300 rounded-md sm:text-sm" placeholder="0,00">
                                        </div>
                                        <div id="creditLimitError" class="hidden mt-1 text-sm text-red-600">Por favor, insira um limite válido</div>
                                    </div>
                                    
                                    <!-- Closing Day -->
                                    <div>
                                        <label for="closingDay" class="block text-sm font-medium text-gray-700">Dia de Fechamento *</label>
                                        <select id="closingDay" name="closingDay" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                            <option value="">Selecione o dia</option>
                                            <script>
                                                for (let i = 1; i <= 31; i++) {
                                                    document.write(`<option value="${i}">${i}</option>`);
                                                }
                                            </script>
                                        </select>
                                        <div id="closingDayError" class="hidden mt-1 text-sm text-red-600">Por favor, selecione o dia de fechamento</div>
                                    </div>
                                    
                                    <!-- Due Day -->
                                    <div>
                                        <label for="dueDay" class="block text-sm font-medium text-gray-700">Dia de Vencimento *</label>
                                        <select id="dueDay" name="dueDay" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                            <option value="">Selecione o dia</option>
                                            <script>
                                                for (let i = 1; i <= 31; i++) {
                                                    document.write(`<option value="${i}">${i}</option>`);
                                                }
                                            </script>
                                        </select>
                                        <div id="dueDayError" class="hidden mt-1 text-sm text-red-600">Por favor, selecione o dia de vencimento</div>
                                    </div>
                                    
                                    <!-- Associated Account -->
                                    <div>
                                        <label for="associatedAccount" class="block text-sm font-medium text-gray-700">Conta Associada *</label>
                                        <select id="associatedAccount" name="associatedAccount" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                            <option value="">Selecione uma conta</option>
                                            <option value="1">Banco do Brasil - Conta Corrente (1234-5)</option>
                                            <option value="2">Santander - Conta PJ (5678-9)</option>
                                            <option value="3">Nubank - Conta Digital (9876-5)</option>
                                        </select>
                                        <div id="associatedAccountError" class="hidden mt-1 text-sm text-red-600">Por favor, selecione uma conta associada</div>
                                    </div>
                                    
                                    <!-- Status -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Status</label>
                                        <div class="mt-2 flex items-center">
                                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                                <input type="checkbox" id="cardStatus" name="cardStatus" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                                <label for="cardStatus" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                                            </div>
                                            <label for="cardStatus" class="text-sm text-gray-700">Ativo</label>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="saveCardBtn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Salvar Cartão
                    </button>
                    <button type="button" id="cancelBtn" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast fixed bottom-4 right-4 hidden">
        <div class="bg-green-500 text-white px-4 py-2 rounded-md shadow-lg">
            <div class="flex items-center">
                <i id="toastIcon" class="fas fa-check-circle mr-2"></i>
                <span id="toastMessage">Cartão cadastrado com sucesso!</span>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const modal = document.getElementById('creditCardModal');
        const openModalBtn = document.getElementById('openModalBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const saveCardBtn = document.getElementById('saveCardBtn');
        const creditCardForm = document.getElementById('creditCardForm');
        const toast = document.getElementById('toast');
        
        // Form fields
        const cardName = document.getElementById('cardName');
        const cardBrand = document.getElementById('cardBrand');
        const lastDigits = document.getElementById('lastDigits');
        const creditLimit = document.getElementById('creditLimit');
        const closingDay = document.getElementById('closingDay');
        const dueDay = document.getElementById('dueDay');
        const associatedAccount = document.getElementById('associatedAccount');
        const cardStatus = document.getElementById('cardStatus');
        
        // Error messages
        const cardNameError = document.getElementById('cardNameError');
        const cardBrandError = document.getElementById('cardBrandError');
        const lastDigitsError = document.getElementById('lastDigitsError');
        const invalidDigitsError = document.getElementById('invalidDigitsError');
        const creditLimitError = document.getElementById('creditLimitError');
        const closingDayError = document.getElementById('closingDayError');
        const dueDayError = document.getElementById('dueDayError');
        const associatedAccountError = document.getElementById('associatedAccountError');
        
        // Toggle switch styling
        document.querySelector('.toggle-checkbox').addEventListener('change', function(e) {
            if(e.target.checked) {
                document.querySelector('.toggle-label').classList.remove('bg-gray-300');
                document.querySelector('.toggle-label').classList.add('bg-blue-500');
            } else {
                document.querySelector('.toggle-label').classList.remove('bg-blue-500');
                document.querySelector('.toggle-label').classList.add('bg-gray-300');
            }
        });
        
        // Initialize toggle switch
        cardStatus.checked = true;
        document.querySelector('.toggle-label').classList.add('bg-blue-500');
        
        // Modal functions
        function openModal() {
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.add('modal-enter-active');
            }, 10);
        }
        
        function closeModal() {
            modal.classList.remove('modal-enter-active');
            setTimeout(() => {
                modal.classList.add('hidden');
                resetForm();
            }, 300);
        }
        
        function resetForm() {
            creditCardForm.reset();
            cardStatus.checked = true;
            document.querySelector('.toggle-label').classList.add('bg-blue-500');
            
            // Hide all error messages
            const errorMessages = document.querySelectorAll('[id$="Error"]');
            errorMessages.forEach(error => {
                error.classList.add('hidden');
            });
        }
        
        // Event listeners
        openModalBtn.addEventListener('click', openModal);
        cancelBtn.addEventListener('click', closeModal);
        
        // Save card button click
        saveCardBtn.addEventListener('click', function() {
            if (validateForm()) {
                // Here you would typically send the data to your backend
                // For this example, we'll just show a success toast
                showToast('Cartão cadastrado com sucesso!', 'success');
                closeModal();
            }
        });
        
        // Form validation
        function validateForm() {
            let isValid = true;
            
            // Card Name validation
            if (!cardName.value.trim()) {
                cardNameError.classList.remove('hidden');
                isValid = false;
            } else {
                cardNameError.classList.add('hidden');
            }
            
            // Card Brand validation
            if (!cardBrand.value) {
                cardBrandError.classList.remove('hidden');
                isValid = false;
            } else {
                cardBrandError.classList.add('hidden');
            }
            
            // Last Digits validation
            if (!lastDigits.value.trim()) {
                lastDigitsError.classList.remove('hidden');
                invalidDigitsError.classList.add('hidden');
                isValid = false;
            } else if (!/^\d{4}$/.test(lastDigits.value)) {
                invalidDigitsError.classList.remove('hidden');
                lastDigitsError.classList.add('hidden');
                isValid = false;
            } else {
                lastDigitsError.classList.add('hidden');
                invalidDigitsError.classList.add('hidden');
            }
            
            // Credit Limit validation
            const limitValue = parseFloat(creditLimit.value.replace(/[^\d,-]/g, '').replace(',', '.'));
            if (isNaN(limitValue) || limitValue <= 0) {
                creditLimitError.classList.remove('hidden');
                isValid = false;
            } else {
                creditLimitError.classList.add('hidden');
            }
            
            // Closing Day validation
            if (!closingDay.value) {
                closingDayError.classList.remove('hidden');
                isValid = false;
            } else {
                closingDayError.classList.add('hidden');
            }
            
            // Due Day validation
            if (!dueDay.value) {
                dueDayError.classList.remove('hidden');
                isValid = false;
            } else {
                dueDayError.classList.add('hidden');
            }
            
            // Associated Account validation
            if (!associatedAccount.value) {
                associatedAccountError.classList.remove('hidden');
                isValid = false;
            } else {
                associatedAccountError.classList.add('hidden');
            }
            
            return isValid;
        }
        
        // Currency mask for credit limit
        creditLimit.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = (value / 100).toFixed(2) + '';
            value = value.replace(".", ",");
            value = value.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
            e.target.value = value;
        });
        
        // Show toast notification
        function showToast(message, type) {
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');
            
            toastMessage.textContent = message;
            
            // Set icon and color based on type
            if (type === 'success') {
                toast.className = 'toast fixed bottom-4 right-4';
                toast.querySelector('div').className = 'bg-green-500 text-white px-4 py-2 rounded-md shadow-lg';
                toastIcon.className = 'fas fa-check-circle mr-2';
            } else if (type === 'error') {
                toast.className = 'toast fixed bottom-4 right-4';
                toast.querySelector('div').className = 'bg-red-500 text-white px-4 py-2 rounded-md shadow-lg';
                toastIcon.className = 'fas fa-exclamation-circle mr-2';
            }
            
            toast.classList.remove('hidden');
            
            // Hide after 3 seconds
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }
        
        // Close modal when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModal();
            }
        });
    </script>
<script src="../componentes/topbar.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                // Exemplo de permissões para um usuário do financeiro
                const userPermissions = {
                    dashboard: true,
                    movimentacoes: true,
                    relatorios: true,
                    pagamentos: true,
                    contas: true,
                    cadastros: true,       
                    configuracoes: true    
                };
                renderTopbar('contas', userPermissions);

                // ...aqui entraria qualquer outro JS específico da página de entradas
            });
        </script>
</body>

</html>